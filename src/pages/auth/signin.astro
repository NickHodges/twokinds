---
import MainLayout from '../../layouts/MainLayout.astro';
import SignInForm from '../../components/SignInForm.astro';
import {
  FACEBOOK_CLIENT_ID,
  MICROSOFT_CLIENT_ID,
  MICROSOFT_TENANT_ID,
  APPLE_CLIENT_ID,
} from 'astro:env/server';

// Get any error from the URL
const error = Astro.url.searchParams.get('error');

// Check if the user is already signed in
if (Astro.locals.session) {
  return Astro.redirect('/');
}

// Check which providers are configured
const hasFacebook = !!FACEBOOK_CLIENT_ID;
const hasMicrosoft = !!MICROSOFT_CLIENT_ID && !!MICROSOFT_TENANT_ID;
const hasApple = !!APPLE_CLIENT_ID;
---

<MainLayout title="Sign In">
  <SignInForm
    hasFacebook={hasFacebook}
    hasMicrosoft={hasMicrosoft}
    hasApple={hasApple}
    error={error}
  />
</MainLayout>
