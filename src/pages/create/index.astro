---
import { db, Intros, Types } from 'astro:db';
import '../../styles/index.css';
import MainLayout from '../../layouts/MainLayout.astro';
import NewSayingForm from '../../components/NewSayingForm.astro';
import PageHeader from '../../components/PageHeader.astro';
import type { ExtendedSession } from '../../env';

// Get the current user's session
const session = Astro.locals.session as ExtendedSession | null;

// Redirect to login if not authenticated
if (!session?.user) {
  return Astro.redirect('/auth/signin');
}

// Fetch data from database
const intros = await db.select().from(Intros);
const types = await db.select().from(Types);

// Don't prerender so we always get fresh data
export const prerender = false;

// Action results will be processed in the NewSayingForm component
---

<MainLayout>
  <div class="flex flex-col">
    <PageHeader title="Create a New Saying" />

    <div class="mx-auto mt-2 mb-8 p-8 bg-white dark:bg-gray-800 rounded-xl shadow-md">
      <style>
        input[name='firstKind'],
        input[name='secondKind'] {
          width: 100% !important;
          max-width: 800px !important;
        }
      </style>

      <NewSayingForm intros={intros} types={types} />
    </div>
  </div>
</MainLayout>
