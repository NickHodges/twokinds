---
import MainLayout from '../../layouts/MainLayout.astro';
import '../../styles/index.css';
import { getSayingById } from '../../lib/db-service';
import PageHeader from '../../components/PageHeader.astro';
import SayingDisplay from '../../components/SayingDisplay.astro';
import ActionButtons from '../../components/ActionButtons.astro';
import NotificationBanner from '../../components/NotificationBanner.astro';

// Get the saying ID from the URL
const { id } = Astro.params;
const sayingId = parseInt(id || '0');

// Fetch the saying directly from Astro:DB
console.log('Fetching saying with ID:', sayingId);
const saying = await getSayingById(sayingId);

// Handle case where saying doesn't exist
const notFound = !saying;

// Don't prerender so we always get fresh data
export const prerender = false;
---

<MainLayout title={saying ? `${saying.intro}` : 'Saying Not Found'}>
  <div class="flex flex-col">
    <PageHeader title="Saying Details" />

    {
      notFound ? (
        <NotificationBanner
          type="error"
          message="We couldn't find the saying you're looking for."
          link={{ url: '/', text: 'Return to home page' }}
        />
      ) : (
        <div class="max-w-2xl mx-auto">
          <SayingDisplay saying={saying} />

          <ActionButtons
            buttons={[
              { text: 'View all sayings', href: '/', primary: true },
              { text: 'Create your own', href: '/create', primary: false },
            ]}
          />
        </div>
      )
    }
  </div>
</MainLayout>
